<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <%- include('layouts/head.email.ejs') %>
  <head>
    <style type="text/css">
      /* Additional responsive styles for Gemini error email */
      @media only screen and (max-width: 600px) {
        .email-wrapper {
          padding: 15px 10px !important;
        }
        
        .email-container {
          max-width: 100% !important;
          margin: 0 !important;
          border-radius: 8px !important;
        }
        
        .alert-header {
          padding: 20px 15px !important;
        }
        
        .content-container {
          padding: 20px 15px !important;
        }
        
        .title {
          font-size: 24px !important;
        }
        
        .subtitle {
          font-size: 14px !important;
        }
        
        .error-summary,
        .request-section,
        .error-section,
        .action-required,
        .service-info {
          padding: 16px !important;
          margin-bottom: 16px !important;
        }
        
        .error-details-table {
          font-size: 12px !important;
        }
        
        .error-details-table td {
          padding: 6px !important;
          margin-bottom: 8px !important;
        }
        
        .error-details-table tr {
          border-bottom: none !important;
        }
        
        .code-block,
        .error-block {
          padding: 12px !important;
          border-radius: 6px !important;
        }
        
        .code-block pre,
        .error-block pre {
          font-size: 11px !important;
          line-height: 1.4 !important;
          overflow-x: auto !important;
        }
        
        h2 {
          font-size: 18px !important;
        }
        
        h3 {
          font-size: 16px !important;
        }
        
        h4 {
          font-size: 14px !important;
        }
        
        ul {
          padding-left: 16px !important;
        }
        
        li {
          font-size: 13px !important;
          margin-bottom: 6px !important;
        }
      }
      
      @media only screen and (max-width: 480px) {
        .email-wrapper {
          padding: 10px 5px !important;
        }
        
        .title {
          font-size: 20px !important;
        }
        
        .error-summary,
        .request-section,
        .error-section,
        .action-required,
        .service-info {
          padding: 12px !important;
          margin-bottom: 15px !important;
        }
        
        .code-block,
        .error-block {
          padding: 8px !important;
        }
        
        .code-block pre,
        .error-block pre {
          font-size: 10px !important;
        }
      }
    </style>
  </head>
  <body style="margin: 0; padding: 0; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); min-height: 100vh;">
    <center class="email-wrapper" style="width: 100%; padding: 30px 15px;">
      <table
        width="100%"
        cellpadding="0"
        cellspacing="0"
        border="0"
        class="email-container"
        style="max-width: 600px; background-color: #ffffff; margin: 0 auto; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);"
      >
        <!-- Header -->
        <tr>
          <td height="4px" class="gradient-border" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)"></td>
        </tr>
        
        <!-- Alert Header -->
        <tr>
          <td class="alert-header" style="text-align: center; padding: 30px 20px; background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border-bottom: 1px solid rgba(139, 92, 246, 0.2);">
            <div class="alert-icon" style="font-size: 48px; margin-bottom: 16px;">ü§ñ</div>
            <h1 class="title" style="font-size: 28px; font-weight: 700; color: #7c3aed; margin: 0 0 8px; line-height: 1.2;">
              Gemini Service Alert
            </h1>
            <p class="subtitle" style="font-size: 16px; color: #581c87; margin: 0; font-weight: 400;">
              Gemini API failure detected and requires attention
            </p>
          </td>
        </tr>

        <!-- Main Content -->
        <tr>
          <td class="content-container" style="padding: 30px 25px;">
            
            <!-- Error Summary -->
            <div class="error-summary" style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border-left: 4px solid #8b5cf6; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
              <h2 style="font-size: 20px; font-weight: 600; color: #7c3aed; margin: 0 0 12px; display: flex; align-items: center;">
                <span style="margin-right: 8px;">‚ö†Ô∏è</span> Error Summary
              </h2>
              <table class="error-details-table" style="width: 100%; font-size: 14px; color: #581c87;">
                <tr>
                  <td style="font-weight: 600; padding: 4px 8px 4px 0; vertical-align: top; min-width: 100px;">Timestamp:</td>
                  <td style="padding: 4px 0; word-break: break-all;"><%= timestamp %></td>
                </tr>
                <tr>
                  <td style="font-weight: 600; padding: 4px 8px 4px 0; vertical-align: top;">Service:</td>
                  <td style="padding: 4px 0;"><%= service %></td>
                </tr>
                <tr>
                  <td style="font-weight: 600; padding: 4px 8px 4px 0; vertical-align: top;">Method:</td>
                  <td style="padding: 4px 0;"><%= method %></td>
                </tr>
                <tr>
                  <td style="font-weight: 600; padding: 4px 8px 4px 0; vertical-align: top;">Model:</td>
                  <td style="padding: 4px 0;"><%= model || 'N/A' %></td>
                </tr>
                <% if (typeof errorCount !== 'undefined' && errorCount > 1) { %>
                <tr>
                  <td style="font-weight: 600; padding: 4px 8px 4px 0; vertical-align: top;">Error Count:</td>
                  <td style="padding: 4px 0; color: #7c3aed; font-weight: 600;"><%= errorCount %> errors since last notification</td>
                </tr>
                <% } %>
                <% if (typeof timeSinceLastEmail !== 'undefined' && timeSinceLastEmail !== 'First error occurrence') { %>
                <tr>
                  <td style="font-weight: 600; padding: 4px 8px 4px 0; vertical-align: top;">Time Since Last Email:</td>
                  <td style="padding: 4px 0;"><%= timeSinceLastEmail %></td>
                </tr>
                <% } %>
              </table>
            </div>

            <!-- Request Details -->
            <div class="request-section" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
              <h3 style="font-size: 18px; font-weight: 600; color: #374151; margin: 0 0 16px; display: flex; align-items: center;">
                <span style="margin-right: 8px;">üì§</span> Request Details
              </h3>
              
              <% if (payload) { %>
              <div class="code-block" style="background: #1f2937; border-radius: 6px; padding: 16px; margin-bottom: 16px; overflow-x: auto;">
                <h4 style="color: #f9fafb; font-size: 14px; font-weight: 600; margin: 0 0 8px;">Request Payload:</h4>
                <pre style="color: #e5e7eb; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.5; margin: 0; white-space: pre-wrap; word-break: break-all;"><%= payload %></pre>
              </div>
              <% } %>
            </div>

            <!-- Error Details -->
            <div class="error-section" style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
              <h3 style="font-size: 18px; font-weight: 600; color: #7c3aed; margin: 0 0 16px; display: flex; align-items: center;">
                <span style="margin-right: 8px;">üîç</span> Error Details
              </h3>
              
              <div class="error-block" style="background: #581c87; border-radius: 6px; padding: 16px; overflow-x: auto;">
                <pre style="color: #e9d5ff; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.5; margin: 0; white-space: pre-wrap; word-break: break-all;"><%= errorDetails %></pre>
              </div>
            </div>

            <!-- Action Required -->
            <div class="action-required" style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); border-left: 4px solid #f59e0b; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
              <h3 style="font-size: 18px; font-weight: 600; color: #92400e; margin: 0 0 12px; display: flex; align-items: center;">
                <span style="margin-right: 8px;">üîß</span> Immediate Action Required
              </h3>
              <ul style="color: #92400e; font-size: 14px; line-height: 1.6; margin: 0; padding-left: 20px;">
                <li style="margin-bottom: 8px;">Check Google AI API key validity and project configuration</li>
                <li style="margin-bottom: 8px;">Verify Gemini service status and quota limits</li>
                <li style="margin-bottom: 8px;">Review request parameters and model availability</li>
                <li style="margin-bottom: 8px;">Monitor for continued failures and user impact</li>
                <li>Consider implementing fallback mechanisms if errors persist</li>
              </ul>
            </div>

            <!-- Service Information -->
            <div class="service-info" style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 20px;">
              <h3 style="font-size: 18px; font-weight: 600; color: #0369a1; margin: 0 0 12px; display: flex; align-items: center;">
                <span style="margin-right: 8px;">‚ÑπÔ∏è</span> Service Information
              </h3>
              <ul style="color: #0369a1; font-size: 14px; line-height: 1.6; margin: 0; padding-left: 20px;">
                <li style="margin-bottom: 8px;"><strong>Service:</strong> Google Gemini AI Integration</li>
                <li style="margin-bottom: 8px;"><strong>Environment:</strong> <%= process.env.NODE_ENV || 'Production' %></li>
                <li style="margin-bottom: 8px;"><strong>Server:</strong> <%= process.env.HOSTNAME || 'Razorcopy API Server' %></li>
                <li><strong>Auto-monitoring:</strong> This alert was generated automatically when the Gemini service encountered an error</li>
              </ul>
            </div>

            <!-- Footer Message -->
            <div class="signature" style="border-top: 1px solid #e2e8f0; padding-top: 20px; text-align: center; margin-top: 30px;">
              <p style="color: #64748b; font-size: 14px; margin: 0; font-weight: 500;">
                This is an automated alert from the Razorcopy monitoring system.<br>
                <span style="color: #8b5cf6; font-weight: 600;">Please investigate and resolve promptly.</span>
              </p>
            </div>
          </td>
        </tr>

        <!-- Footer -->
        <%- include('layouts/footer.email.ejs') %>
      </table>
    </center>
  </body>
</html>
